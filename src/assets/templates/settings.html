<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Settings - Dolphin Enquiries</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-6">
  <div class="max-w-lg mx-auto">
    <h1 class="text-2xl font-bold mb-6">Settings</h1>

    <!-- Tabs -->
    <div class="mb-6 border-b border-gray-300 dark:border-gray-700">
      <nav class="flex flex-wrap space-x-4" aria-label="Tabs" id="tabs">
        <button
          class="py-2 px-4 border-b-2 border-blue-600 dark:border-blue-400 font-semibold text-blue-600 dark:text-blue-400 focus:outline-none"
          data-tab="smtp" type="button">
          SMTP Settings
        </button>
        <button
          class="py-2 px-4 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-gray-600 dark:text-gray-400 focus:outline-none"
          data-tab="sftp1" type="button">
          SFTP One (Origin)
        </button>
        <button
          class="py-2 px-4 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-gray-600 dark:text-gray-400 focus:outline-none"
          data-tab="sftp2" type="button">
          SFTP Two (Origin)
        </button>
        <button
          class="py-2 px-4 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-gray-600 dark:text-gray-400 focus:outline-none"
          data-tab="sftp2" type="button">
          SFTP Three (Destination)
        </button>
        <button
          class="py-2 px-4 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-gray-600 dark:text-gray-400 focus:outline-none"
          data-tab="snowflake" type="button">
          Snowflake
        </button>
        <button
          class="py-2 px-4 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-gray-600 dark:text-gray-400 focus:outline-none"
          data-tab="cronitor" type="button">
          Cronitor
        </button>
      </nav>
    </div>

    <!-- Tab Contents -->
    <div>
      <!-- SMTP Settings Form -->
      <form id="smtpForm" class="space-y-4 tab-content" data-tab-content="smtp">
        <div>
          <label for="host" class="block text-sm font-medium mb-1">SMTP Host</label>
          <input type="text" id="host" name="host" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>

        <div>
          <label for="port" class="block text-sm font-medium mb-1">Port</label>
          <input type="number" id="port" name="port" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>

        <div class="flex items-center">
          <input type="checkbox" id="secure" name="secure"
            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-700" />
          <label for="secure" class="ml-2 text-sm">Use SSL/TLS</label>
        </div>

        <div>
          <label for="user" class="block text-sm font-medium mb-1">Username</label>
          <input type="text" id="user" name="user" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>

        <div>
          <label for="pass" class="block text-sm font-medium mb-1">Password</label>
          <input type="password" id="pass" name="pass" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>

        <div>
          <label for="to" class="block text-sm font-medium mb-1">Recipient Email
            (comma-separated)</label>
          <input type="text" id="to" name="to" required placeholder="example@email.com,exampletwo@email.com"
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>

        <div class="pt-4">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
            Save SMTP Settings
          </button>
        </div>
        <div id="smtpStatus" class="mt-2 text-sm text-center hidden"></div>
      </form>

      <!-- SFTP One Form -->
      <form id="sftp1Form" class="space-y-4 tab-content hidden" data-tab-content="sftp1">
        <div>
          <label for="sftp1Host" class="block text-sm font-medium mb-1">SFTP Host</label>
          <input type="text" id="sftp1Host" name="sftp1Host" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp1Port" class="block text-sm font-medium mb-1">Port</label>
          <input type="number" id="sftp1Port" name="sftp1Port" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp1User" class="block text-sm font-medium mb-1">Username</label>
          <input type="text" id="sftp1User" name="sftp1User" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp1Pass" class="block text-sm font-medium mb-1">Password</label>
          <input type="password" id="sftp1Pass" name="sftp1Pass" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp1RemotePath" class="block text-sm font-medium mb-1">Remote Path</label>
          <input type="text" id="sftp1RemotePath" name="sftp1RemotePath" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div class="pt-4">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
            Save SFTP One Settings
          </button>
        </div>
        <div id="sftp1Status" class="mt-2 text-sm text-center hidden"></div>
      </form>

      <!-- SFTP Two Form -->
      <form id="sftp2Form" class="space-y-4 tab-content hidden" data-tab-content="sftp2">
        <div>
          <label for="sftp2Host" class="block text-sm font-medium mb-1">SFTP Host</label>
          <input type="text" id="sftp2Host" name="sftp2Host" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp2Port" class="block text-sm font-medium mb-1">Port</label>
          <input type="number" id="sftp2Port" name="sftp2Port" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp2User" class="block text-sm font-medium mb-1">Username</label>
          <input type="text" id="sftp2User" name="sftp2User" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp2Pass" class="block text-sm font-medium mb-1">Password</label>
          <input type="password" id="sftp2Pass" name="sftp2Pass" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp2RemotePath" class="block text-sm font-medium mb-1">Remote Path</label>
          <input type="text" id="sftp2RemotePath" name="sftp2RemotePath" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div class="pt-4">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
            Save SFTP Two Settings
          </button>
        </div>
        <div id="sftp2Status" class="mt-2 text-sm text-center hidden"></div>
      </form>

      <!-- SFTP Three Form -->
      <form id="sftp3Form" class="space-y-4 tab-content hidden" data-tab-content="sftp3">
        <div>
          <label for="sftp3Host" class="block text-sm font-medium mb-1">SFTP Host</label>
          <input type="text" id="sftp3Host" name="sftp3Host" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp3Port" class="block text-sm font-medium mb-1">Port</label>
          <input type="number" id="sftp3Port" name="sftp3Port" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp3User" class="block text-sm font-medium mb-1">Username</label>
          <input type="text" id="sftp3User" name="sftp3User" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp3Pass" class="block text-sm font-medium mb-1">Password</label>
          <input type="password" id="sftp3Pass" name="sftp3Pass" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="sftp3UploadPath" class="block text-sm font-medium mb-1">Upload Path</label>
          <input type="text" id="sftp3UploadPath" name="sftp3UploadPath" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div class="pt-4">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
            Save SFTP Three Settings
          </button>
        </div>
        <div id="sftp2Status" class="mt-2 text-sm text-center hidden"></div>
      </form>
      <!-- Snowflake Form -->
      <form id="snowflakeForm" class="space-y-4 tab-content hidden" data-tab-content="snowflake">
        <div>
          <label for="account" class="block text-sm font-medium mb-1">Account</label>
          <input type="text" id="account" name="account" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="username" class="block text-sm font-medium mb-1">Username</label>
          <input type="text" id="username" name="username" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="password" class="block text-sm font-medium mb-1">Password</label>
          <input type="password" id="password" name="password" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="warehouse" class="block text-sm font-medium mb-1">Warehouse</label>
          <input type="text" id="warehouse" name="warehouse" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="database" class="block text-sm font-medium mb-1">Database</label>
          <input type="text" id="database" name="database" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="schema" class="block text-sm font-medium mb-1">Schema</label>
          <input type="text" id="schema" name="schema" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div>
          <label for="role" class="block text-sm font-medium mb-1">Role</label>
          <input type="text" id="role" name="role" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div class="pt-4">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
            Save Snowflake Settings
          </button>
        </div>
        <div id="snowflakeFormStatus" class="mt-2 text-sm text-center hidden"></div>
      </form>

      <!-- Cronitor Form -->
      <form id="cronitorForm" class="space-y-4 tab-content hidden" data-tab-content="cronitor">
        <div>
          <label for="apiKey" class="block text-sm font-medium mb-1">API Key</label>
          <input type="text" id="apiKey" name="apiKey" required
            class="w-full px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700" />
        </div>
        <div class="pt-4">
          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
            Save Cronitor Settings
          </button>
        </div>
        <div id="cronitorFormStatus" class="mt-2 text-sm text-center hidden"></div>
      </form>
    </div>
  </div>

  <script>
    const tabs = document.querySelectorAll('#tabs button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        tabs.forEach((t) => {
          t.classList.remove('border-blue-600', 'dark:border-blue-400', 'text-blue-600', 'dark:text-blue-400', 'font-semibold');
          t.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-400');
        });

        tabContents.forEach((content) => content.classList.add('hidden'));

        tab.classList.add('border-blue-600', 'dark:border-blue-400', 'text-blue-600', 'dark:text-blue-400', 'font-semibold');
        tab.classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-400');

        const selectedTab = tab.getAttribute('data-tab');
        document.querySelector(`[data-tab-content="${selectedTab}"]`).classList.remove('hidden');
      });
    });

    async function loadSettings() {
      const smtpConfig = await window.electronAPI?.getSMTPConfig?.();
      if (smtpConfig) {
        document.getElementById('host').value = smtpConfig.host;
        document.getElementById('port').value = smtpConfig.port;
        document.getElementById('secure').checked = smtpConfig.secure;
        document.getElementById('user').value = smtpConfig.user;
        document.getElementById('pass').value = smtpConfig.pass;
        document.getElementById('to').value = smtpConfig.to;
      }

      const sftp1Config = await window.electronAPI?.getSFTP1Config?.();
      if (sftp1Config) {
        document.getElementById('sftp1Host').value = sftp1Config.host;
        document.getElementById('sftp1Port').value = sftp1Config.port;
        document.getElementById('sftp1User').value = sftp1Config.username;
        document.getElementById('sftp1Pass').value = sftp1Config.password;
        document.getElementById('sftp1RemotePath').value = sftp1Config.remotePath;
      }

      const sftp2Config = await window.electronAPI?.getSFTP2Config?.();
      if (sftp2Config) {
        document.getElementById('sftp2Host').value = sftp2Config.host;
        document.getElementById('sftp2Port').value = sftp2Config.port;
        document.getElementById('sftp2User').value = sftp2Config.username;
        document.getElementById('sftp2Pass').value = sftp2Config.password;
        document.getElementById('sftp2RemotePath').value = sftp2Config.remotePath;
      }

      const sftp3Config = await window.electronAPI?.getSFTP3Config?.();
      if (sftp3Config) {
        document.getElementById('sftp3Host').value = sftp3Config.host;
        document.getElementById('sftp3Port').value = sftp3Config.port;
        document.getElementById('sftp3User').value = sftp3Config.username;
        document.getElementById('sftp3Pass').value = sftp3Config.password;
        document.getElementById('sftp3UploadPath').value = sftp3Config.uploadPath;
      }

      const databaseConfig = await window.electronAPI?.getSnowflakeConfig?.();
      if (databaseConfig) {
        document.getElementById('account').value = databaseConfig.account;
        document.getElementById('username').value = databaseConfig.username;
        document.getElementById('password').value = databaseConfig.password;
        document.getElementById('warehouse').value = databaseConfig.warehouse;
        document.getElementById('database').value = databaseConfig.database;
        document.getElementById('schema').value = databaseConfig.schema;
        document.getElementById('role').value = databaseConfig.role;
      }

      const cronitorConfig = await window.electronAPI?.getCronitorConfig?.();
      if (cronitorConfig) {
        document.getElementById('apiKey').value = cronitorConfig.apiKey;
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      tabs[0].click();
      loadSettings();
    });

    document.getElementById('smtpForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('smtpStatus');
      status.textContent = 'Saving...';
      status.classList.remove('hidden', 'text-red-600', 'text-green-600');
      status.classList.add('text-gray-600');

      try {
        const config = {
          host: document.getElementById('host').value,
          port: parseInt(document.getElementById('port').value),
          secure: document.getElementById('secure').checked,
          user: document.getElementById('user').value,
          pass: document.getElementById('pass').value,
          to: document.getElementById('to').value,
        };
        const result = await window.electronAPI?.saveSMTPConfig?.(config);

        if (!result) throw new Error('No response from backend');

        if (result.success) {
          status.textContent = 'SMTP Settings saved successfully!';
          status.classList.remove('text-gray-600', 'text-red-600');
          status.classList.add('text-green-600');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        status.textContent = `Error: ${error.message}`;
        status.classList.remove('text-gray-600', 'text-green-600');
        status.classList.add('text-red-600');
      }
      status.classList.remove('hidden');
      setTimeout(() => status.classList.add('hidden'), 5000);
    });

    document.getElementById('sftp1Form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('sftp1Status');
      status.textContent = 'Saving...';
      status.classList.remove('hidden', 'text-red-600', 'text-green-600');
      status.classList.add('text-gray-600');

      try {
        const config = {
          host: document.getElementById('sftp1Host').value,
          port: parseInt(document.getElementById('sftp1Port').value),
          username: document.getElementById('sftp1User').value,
          password: document.getElementById('sftp1Pass').value,
          remotePath: document.getElementById('sftp1RemotePath').value,
        };
        const result = await window.electronAPI?.saveSFTP1Config?.(config);

        if (!result) throw new Error('No response from backend');

        if (result.success) {
          status.textContent = 'SFTP One Settings saved successfully!';
          status.classList.remove('text-gray-600', 'text-red-600');
          status.classList.add('text-green-600');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        status.textContent = `Error: ${error.message}`;
        status.classList.remove('text-gray-600', 'text-green-600');
        status.classList.add('text-red-600');
      }
      status.classList.remove('hidden');
      setTimeout(() => status.classList.add('hidden'), 5000);
    });

    document.getElementById('sftp2Form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('sftp2Status');
      status.textContent = 'Saving...';
      status.classList.remove('hidden', 'text-red-600', 'text-green-600');
      status.classList.add('text-gray-600');

      try {
        const config = {
          host: document.getElementById('sftp2Host').value,
          port: parseInt(document.getElementById('sftp2Port').value),
          username: document.getElementById('sftp2User').value,
          password: document.getElementById('sftp2Pass').value,
          remotePath: document.getElementById('sftp2RemotePath').value,
        };
        const result = await window.electronAPI?.saveSFTP2Config?.(config);

        if (!result) throw new Error('No response from backend');

        if (result.success) {
          status.textContent = 'SFTP Two Settings saved successfully!';
          status.classList.remove('text-gray-600', 'text-red-600');
          status.classList.add('text-green-600');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        status.textContent = `Error: ${error.message}`;
        status.classList.remove('text-gray-600', 'text-green-600');
        status.classList.add('text-red-600');
      }
      status.classList.remove('hidden');
      setTimeout(() => status.classList.add('hidden'), 5000);
    });

    document.getElementById('sftp3Form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('sftp3Status');
      status.textContent = 'Saving...';
      status.classList.remove('hidden', 'text-red-600', 'text-green-600');
      status.classList.add('text-gray-600');

      try {
        const config = {
          host: document.getElementById('sftp3Host').value,
          port: parseInt(document.getElementById('sftp3Port').value),
          username: document.getElementById('sftp3User').value,
          password: document.getElementById('sftp3Pass').value,
          uploadPath: document.getElementById('sftp3UploadPath').value,
        };
        const result = await window.electronAPI?.saveSFTP3Config?.(config);

        if (!result) throw new Error('No response from backend');

        if (result.success) {
          status.textContent = 'SFTP Three Settings saved successfully!';
          status.classList.remove('text-gray-600', 'text-red-600');
          status.classList.add('text-green-600');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        status.textContent = `Error: ${error.message}`;
        status.classList.remove('text-gray-600', 'text-green-600');
        status.classList.add('text-red-600');
      }
      status.classList.remove('hidden');
      setTimeout(() => status.classList.add('hidden'), 5000);
    });

    document.getElementById('snowflakeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('snowflakeFormStatus');
      status.textContent = 'Saving...';
      status.classList.remove('hidden', 'text-red-600', 'text-green-600');
      status.classList.add('text-gray-600');

      try {
        const config = {
          account: document.getElementById('account').value,
          username: document.getElementById('username').value,
          password: document.getElementById('password').value,
          warehouse: document.getElementById('warehouse').value,
          database: document.getElementById('database').value,
          schema: document.getElementById('schema').value,
          role: document.getElementById('role').value,
        };
        const result = await window.electronAPI?.saveSnowflakeConfig?.(config);

        if (!result) throw new Error('No response from backend');

        if (result.success) {
          status.textContent = 'Database Settings saved successfully!';
          status.classList.remove('text-gray-600', 'text-red-600');
          status.classList.add('text-green-600');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        status.textContent = `Error: ${error.message}`;
        status.classList.remove('text-gray-600', 'text-green-600');
        status.classList.add('text-red-600');
      }
      status.classList.remove('hidden');
      setTimeout(() => status.classList.add('hidden'), 5000);
    });

    document.getElementById('cronitorForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('cronitorFormStatus');
      status.textContent = 'Saving...';
      status.classList.remove('hidden', 'text-red-600', 'text-green-600');
      status.classList.add('text-gray-600');

      try {
        const config = {
          apiKey: document.getElementById('apiKey').value,
        };
        const result = await window.electronAPI?.saveCronitorConfig?.(config);

        if (!result) throw new Error('No response from backend');

        if (result.success) {
          status.textContent = 'Cronitor Settings saved successfully!';
          status.classList.remove('text-gray-600', 'text-red-600');
          status.classList.add('text-green-600');
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        status.textContent = `Error: ${error.message}`;
        status.classList.remove('text-gray-600', 'text-green-600');
        status.classList.add('text-red-600');
      }
      status.classList.remove('hidden');
      setTimeout(() => status.classList.add('hidden'), 5000);
    });

    window.electronAPI?.onThemeChanged?.((theme) => {
      document.documentElement.classList.toggle('dark', theme === 'dark');
    });
  </script>
</body>

</html>